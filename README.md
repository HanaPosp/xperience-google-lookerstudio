![Kentico.Xperience.Libraries 13.0.0](https://img.shields.io/badge/Kentico.Xperience.Libraries-v13.0.0-orange)
[![Stack Overflow](https://img.shields.io/badge/Stack%20Overflow-ASK%20NOW-FE7A16.svg?logo=stackoverflow&logoColor=white)](https://stackoverflow.com/tags/kentico)

# Xperience Google Data Studio Integration

Create stunning and flexible [Google Data Studio](https://marketingplatform.google.com/about/data-studio/) reports which display data from your Xperience administration website using this custom [connector](https://support.google.com/datastudio/answer/6318763)!

![Sample report](/img/report-sample.png)

## Installation

1.  Download the _Kentico.Xperience.Google.DataStudio_ ZIP package by locating the latest [Release](https://github.com/Kentico/xperience-google-datastudio/releases).
1. In the Xperience adminstration, open the __Sites__ application.
1. [Import](https://docs.xperience.io/deploying-websites/exporting-and-importing-sites/importing-a-site-or-objects) the downloaded package with the __Import files__ and __Import code files__ [settings](https://docs.xperience.io/deploying-websites/exporting-and-importing-sites/importing-a-site-or-objects#Importingasiteorobjects-Import-Objectselectionsettings) enabled.
1. Perform the [necessary steps](https://docs.xperience.io/deploying-websites/exporting-and-importing-sites/importing-a-site-or-objects#Importingasiteorobjects-Importingpackageswithfiles) to include the following imported folder in your project:
   - `/CMSModules/Kentico.Xperience.Google.DataStudio`

## Generating the report in Xperience

To reduce the number of database queries required to display your Xperience data, this integration generates a physical JSON file in the _App_Data/CMSModules/Kentico.Xperience.Google.DataStudio_ directory. This file is generated by the scheduled task "Generate Google Data Studio Report" which is configured to run daily by default. To begin using the Google Data Studio connector immediately after installing the integration, go to the __Scheduled tasks__ application and manually execute the task.

### Configuring report fields

The generated report contains certain fields by default, which you can find in [`DataStudioDefaultFieldSets.cs`](/src/Kentico.Xperience.Google.DataStudio/DataStudioDefaultFieldSets.cs). The report fields are defined by [`FieldSets`](/src/Kentico.Xperience.Google.DataStudio/Models/FieldSet.cs) which represent a single object type (like contacts) and its fields which are represented by a list of [`FieldDefinitions`](/src/Kentico.Xperience.Google.DataStudio/Models/FieldDefinition.cs).

To modify the default list of fields, you can handle the `GetFieldSets` method within a custom implementation of [`IReportSchemaProvider`](/src/Kentico.Xperience.Google.DataStudio/Services/IReportSchemaProvider.cs). For example, if your reports only need to display contacts and activities, you can remove the other default `FieldSets`:

```cs
[assembly: RegisterImplementation(typeof(IReportSchemaProvider), typeof(CustomReportSchemaProvider), Lifestyle = Lifestyle.Singleton, Priority = RegistrationPriority.Default)]
namespace Kentico.Xperience.Google.DataStudio.Services.Implementations
{
    /// <summary>
    /// Custom implementation of <see cref="IReportSchemaProvider"/>.
    /// </summary>
    public class CustomReportSchemaProvider : IReportSchemaProvider
    {
        public IEnumerable<FieldSet> GetFieldSets()
        {
            return new FieldSet[]
            {
                DataStudioDefaultFieldSets.activityFieldSet,
                DataStudioDefaultFieldSets.contactFieldSet
            };
        }
```

You can also add/remove `FieldDefinitions` from the default [`FieldSet.Fields`](/src/Kentico.Xperience.Google.DataStudio/Models/FieldSet.cs#L24) properties, or create your own custom `FieldSets`. For example, to add products to the report you can create a new `FieldSet` which contains the fields you are interested in displaying:

```cs
public IEnumerable<FieldSet> GetFieldSets()
{
    return new FieldSet[]
    {
        DataStudioDefaultFieldSets.activityFieldSet,
        // Other FieldSets...
        new FieldSet {
          ObjectType = SKUInfo.OBJECT_TYPE_SKU,
          DateFilterField = nameof(SKUInfo.SKUCreated),
          Fields = new FieldDefinition[]
          {
              new FieldDefinition {
                  Name = nameof(SKUInfo.SKUID),
                  DataType = DataStudioFieldType.TEXT,
                  Anonymize = true
              },
              new FieldDefinition {
                  Name = nameof(SKUInfo.SKUCreated),
                  DataType = DataStudioFieldType.YEAR_MONTH_DAY_SECOND
              }
          }
        },
    };
}
```

## Adding the Xperience data source

When creating a [new](https://datastudio.google.com/) Google Data Studio report or adding a data source to an existing report, you will find a new "Kentico Xperience" connector to choose:

![Xperience connector](/img/xperience-connector.png)


## Contributing

Please see [`CONTRIBUTING.md`](CONTRIBUTING.md) for more information.

## License

Distributed under the MIT License. See [`LICENSE.md`](./LICENSE.md) for more information.